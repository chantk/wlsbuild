/* valadovastructmodule.c generated by valac, the Vala compiler
 * generated from valadovastructmodule.vala, do not modify */

/* valadovastructmodule.vala
 *
 * Copyright (C) 2006-2009  Jürg Billeter
 *
 * This library is free software; you can redistribute it and/or
 * modify it under the terms of the GNU Lesser General Public
 * License as published by the Free Software Foundation; either
 * version 2.1 of the License, or (at your option) any later version.

 * This library is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
 * Lesser General Public License for more details.

 * You should have received a copy of the GNU Lesser General Public
 * License along with this library; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301  USA
 *
 * Author:
 * 	Jürg Billeter <j@bitron.ch>
 */

#include <glib.h>
#include <glib-object.h>
#include <vala.h>
#include <valaccode.h>
#include <stdlib.h>
#include <string.h>
#include <valagee.h>


#define VALA_TYPE_DOVA_BASE_MODULE (vala_dova_base_module_get_type ())
#define VALA_DOVA_BASE_MODULE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), VALA_TYPE_DOVA_BASE_MODULE, ValaDovaBaseModule))
#define VALA_DOVA_BASE_MODULE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), VALA_TYPE_DOVA_BASE_MODULE, ValaDovaBaseModuleClass))
#define VALA_IS_DOVA_BASE_MODULE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), VALA_TYPE_DOVA_BASE_MODULE))
#define VALA_IS_DOVA_BASE_MODULE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), VALA_TYPE_DOVA_BASE_MODULE))
#define VALA_DOVA_BASE_MODULE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), VALA_TYPE_DOVA_BASE_MODULE, ValaDovaBaseModuleClass))

typedef struct _ValaDovaBaseModule ValaDovaBaseModule;
typedef struct _ValaDovaBaseModuleClass ValaDovaBaseModuleClass;
typedef struct _ValaDovaBaseModulePrivate ValaDovaBaseModulePrivate;

#define VALA_TYPE_CCODE_DECLARATION_SPACE (vala_ccode_declaration_space_get_type ())
#define VALA_CCODE_DECLARATION_SPACE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), VALA_TYPE_CCODE_DECLARATION_SPACE, ValaCCodeDeclarationSpace))
#define VALA_CCODE_DECLARATION_SPACE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), VALA_TYPE_CCODE_DECLARATION_SPACE, ValaCCodeDeclarationSpaceClass))
#define VALA_IS_CCODE_DECLARATION_SPACE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), VALA_TYPE_CCODE_DECLARATION_SPACE))
#define VALA_IS_CCODE_DECLARATION_SPACE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), VALA_TYPE_CCODE_DECLARATION_SPACE))
#define VALA_CCODE_DECLARATION_SPACE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), VALA_TYPE_CCODE_DECLARATION_SPACE, ValaCCodeDeclarationSpaceClass))

typedef struct _ValaCCodeDeclarationSpace ValaCCodeDeclarationSpace;
typedef struct _ValaCCodeDeclarationSpaceClass ValaCCodeDeclarationSpaceClass;

#define VALA_DOVA_BASE_MODULE_TYPE_EMIT_CONTEXT (vala_dova_base_module_emit_context_get_type ())
#define VALA_DOVA_BASE_MODULE_EMIT_CONTEXT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), VALA_DOVA_BASE_MODULE_TYPE_EMIT_CONTEXT, ValaDovaBaseModuleEmitContext))
#define VALA_DOVA_BASE_MODULE_EMIT_CONTEXT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), VALA_DOVA_BASE_MODULE_TYPE_EMIT_CONTEXT, ValaDovaBaseModuleEmitContextClass))
#define VALA_DOVA_BASE_MODULE_IS_EMIT_CONTEXT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), VALA_DOVA_BASE_MODULE_TYPE_EMIT_CONTEXT))
#define VALA_DOVA_BASE_MODULE_IS_EMIT_CONTEXT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), VALA_DOVA_BASE_MODULE_TYPE_EMIT_CONTEXT))
#define VALA_DOVA_BASE_MODULE_EMIT_CONTEXT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), VALA_DOVA_BASE_MODULE_TYPE_EMIT_CONTEXT, ValaDovaBaseModuleEmitContextClass))

typedef struct _ValaDovaBaseModuleEmitContext ValaDovaBaseModuleEmitContext;
typedef struct _ValaDovaBaseModuleEmitContextClass ValaDovaBaseModuleEmitContextClass;

#define VALA_TYPE_DOVA_STRUCT_MODULE (vala_dova_struct_module_get_type ())
#define VALA_DOVA_STRUCT_MODULE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), VALA_TYPE_DOVA_STRUCT_MODULE, ValaDovaStructModule))
#define VALA_DOVA_STRUCT_MODULE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), VALA_TYPE_DOVA_STRUCT_MODULE, ValaDovaStructModuleClass))
#define VALA_IS_DOVA_STRUCT_MODULE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), VALA_TYPE_DOVA_STRUCT_MODULE))
#define VALA_IS_DOVA_STRUCT_MODULE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), VALA_TYPE_DOVA_STRUCT_MODULE))
#define VALA_DOVA_STRUCT_MODULE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), VALA_TYPE_DOVA_STRUCT_MODULE, ValaDovaStructModuleClass))

typedef struct _ValaDovaStructModule ValaDovaStructModule;
typedef struct _ValaDovaStructModuleClass ValaDovaStructModuleClass;
typedef struct _ValaDovaStructModulePrivate ValaDovaStructModulePrivate;
#define _g_free0(var) (var = (g_free (var), NULL))
#define _vala_ccode_node_unref0(var) ((var == NULL) ? NULL : (var = (vala_ccode_node_unref (var), NULL)))
#define _vala_collection_object_unref0(var) ((var == NULL) ? NULL : (var = (vala_collection_object_unref (var), NULL)))
#define _vala_code_node_unref0(var) ((var == NULL) ? NULL : (var = (vala_code_node_unref (var), NULL)))
#define _vala_dova_base_module_emit_context_unref0(var) ((var == NULL) ? NULL : (var = (vala_dova_base_module_emit_context_unref (var), NULL)))

struct _ValaDovaBaseModule {
	ValaCodeGenerator parent_instance;
	ValaDovaBaseModulePrivate * priv;
	ValaSymbol* root_symbol;
	ValaDovaBaseModuleEmitContext* emit_context;
	ValaCCodeDeclarationSpace* header_declarations;
	ValaCCodeDeclarationSpace* source_declarations;
	ValaCCodeFragment* source_type_member_definition;
	ValaCCodeFragment* module_init_fragment;
	ValaCCodeFragment* instance_init_fragment;
	ValaCCodeFragment* instance_finalize_fragment;
	ValaCCodeFragment* pre_statement_fragment;
	gint next_wrapper_id;
	ValaDataType* void_type;
	ValaDataType* bool_type;
	ValaDataType* char_type;
	ValaDataType* short_type;
	ValaDataType* ushort_type;
	ValaDataType* int_type;
	ValaDataType* uint_type;
	ValaDataType* long_type;
	ValaDataType* ulong_type;
	ValaDataType* string_type;
	ValaDataType* float_type;
	ValaDataType* double_type;
	ValaClass* object_class;
	ValaClass* type_class;
	ValaClass* value_class;
	ValaClass* string_class;
	ValaClass* array_class;
	ValaClass* delegate_class;
	ValaClass* error_class;
};

struct _ValaDovaBaseModuleClass {
	ValaCodeGeneratorClass parent_class;
	void (*generate_struct_declaration) (ValaDovaBaseModule* self, ValaStruct* st, ValaCCodeDeclarationSpace* decl_space);
	void (*generate_delegate_declaration) (ValaDovaBaseModule* self, ValaDelegate* d, ValaCCodeDeclarationSpace* decl_space);
	void (*generate_cparameters) (ValaDovaBaseModule* self, ValaMethod* m, ValaCCodeDeclarationSpace* decl_space, ValaCCodeFunction* func, ValaCCodeFunctionDeclarator* vdeclarator, ValaCCodeFunctionCall* vcall);
	void (*generate_property_accessor_declaration) (ValaDovaBaseModule* self, ValaPropertyAccessor* acc, ValaCCodeDeclarationSpace* decl_space);
	ValaCCodeExpression* (*get_dup_func_expression) (ValaDovaBaseModule* self, ValaDataType* type, ValaSourceReference* source_reference, gboolean is_chainup);
	ValaCCodeExpression* (*get_unref_expression) (ValaDovaBaseModule* self, ValaCCodeExpression* cvar, ValaDataType* type, ValaExpression* expr);
	void (*append_local_free) (ValaDovaBaseModule* self, ValaSymbol* sym, ValaCCodeFragment* cfrag, gboolean stop_at_loop);
	ValaCCodeExpression* (*get_ref_cexpression) (ValaDovaBaseModule* self, ValaDataType* expression_type, ValaCCodeExpression* cexpr, ValaExpression* expr, ValaCodeNode* node);
	void (*generate_class_declaration) (ValaDovaBaseModule* self, ValaClass* cl, ValaCCodeDeclarationSpace* decl_space);
	void (*generate_interface_declaration) (ValaDovaBaseModule* self, ValaInterface* iface, ValaCCodeDeclarationSpace* decl_space);
	void (*generate_method_declaration) (ValaDovaBaseModule* self, ValaMethod* m, ValaCCodeDeclarationSpace* decl_space);
	ValaCCodeExpression* (*get_implicit_cast_expression) (ValaDovaBaseModule* self, ValaCCodeExpression* source_cexpr, ValaDataType* expression_type, ValaDataType* target_type, ValaExpression* expr);
	char* (*get_custom_creturn_type) (ValaDovaBaseModule* self, ValaMethod* m);
	gboolean (*method_has_wrapper) (ValaDovaBaseModule* self, ValaMethod* method);
	void (*add_simple_check) (ValaDovaBaseModule* self, ValaCodeNode* node, ValaCCodeFragment* cfrag, gboolean always_fails);
};

struct _ValaDovaStructModule {
	ValaDovaBaseModule parent_instance;
	ValaDovaStructModulePrivate * priv;
};

struct _ValaDovaStructModuleClass {
	ValaDovaBaseModuleClass parent_class;
};


static gpointer vala_dova_struct_module_parent_class = NULL;

GType vala_dova_base_module_get_type (void) G_GNUC_CONST;
gpointer vala_ccode_declaration_space_ref (gpointer instance);
void vala_ccode_declaration_space_unref (gpointer instance);
GParamSpec* vala_param_spec_ccode_declaration_space (const gchar* name, const gchar* nick, const gchar* blurb, GType object_type, GParamFlags flags);
void vala_value_set_ccode_declaration_space (GValue* value, gpointer v_object);
void vala_value_take_ccode_declaration_space (GValue* value, gpointer v_object);
gpointer vala_value_get_ccode_declaration_space (const GValue* value);
GType vala_ccode_declaration_space_get_type (void) G_GNUC_CONST;
gpointer vala_dova_base_module_emit_context_ref (gpointer instance);
void vala_dova_base_module_emit_context_unref (gpointer instance);
GParamSpec* vala_dova_base_module_param_spec_emit_context (const gchar* name, const gchar* nick, const gchar* blurb, GType object_type, GParamFlags flags);
void vala_dova_base_module_value_set_emit_context (GValue* value, gpointer v_object);
void vala_dova_base_module_value_take_emit_context (GValue* value, gpointer v_object);
gpointer vala_dova_base_module_value_get_emit_context (const GValue* value);
GType vala_dova_base_module_emit_context_get_type (void) G_GNUC_CONST;
GType vala_dova_struct_module_get_type (void) G_GNUC_CONST;
enum  {
	VALA_DOVA_STRUCT_MODULE_DUMMY_PROPERTY
};
static void vala_dova_struct_module_real_generate_struct_declaration (ValaDovaBaseModule* base, ValaStruct* st, ValaCCodeDeclarationSpace* decl_space);
gboolean vala_ccode_declaration_space_add_symbol_declaration (ValaCCodeDeclarationSpace* self, ValaSymbol* sym, const char* name);
void vala_dova_base_module_generate_struct_declaration (ValaDovaBaseModule* self, ValaStruct* st, ValaCCodeDeclarationSpace* decl_space);
void vala_ccode_declaration_space_add_type_declaration (ValaCCodeDeclarationSpace* self, ValaCCodeNode* node);
void vala_dova_base_module_generate_type_declaration (ValaDovaBaseModule* self, ValaDataType* type, ValaCCodeDeclarationSpace* decl_space);
void vala_ccode_declaration_space_add_type_definition (ValaCCodeDeclarationSpace* self, ValaCCodeNode* node);
static void vala_dova_struct_module_real_visit_struct (ValaCodeVisitor* base, ValaStruct* st);
void vala_dova_base_module_push_context (ValaDovaBaseModule* self, ValaDovaBaseModuleEmitContext* emit_context);
ValaDovaBaseModuleEmitContext* vala_dova_base_module_emit_context_new (ValaSymbol* symbol);
ValaDovaBaseModuleEmitContext* vala_dova_base_module_emit_context_construct (GType object_type, ValaSymbol* symbol);
void vala_dova_base_module_pop_context (ValaDovaBaseModule* self);
ValaDovaStructModule* vala_dova_struct_module_new (void);
ValaDovaStructModule* vala_dova_struct_module_construct (GType object_type);
ValaDovaBaseModule* vala_dova_base_module_new (void);
ValaDovaBaseModule* vala_dova_base_module_construct (GType object_type);



static void vala_dova_struct_module_real_generate_struct_declaration (ValaDovaBaseModule* base, ValaStruct* st, ValaCCodeDeclarationSpace* decl_space) {
	ValaDovaStructModule * self;
	char* _tmp0_;
	gboolean _tmp1_;
	char* _tmp6_;
	char* _tmp7_;
	ValaCCodeStruct* _tmp8_;
	ValaCCodeStruct* instance_struct;
	char* _tmp15_;
	char* _tmp16_;
	char* _tmp17_;
	ValaCCodeVariableDeclarator* _tmp18_;
	ValaCCodeTypeDefinition* _tmp19_;
	self = (ValaDovaStructModule*) base;
	g_return_if_fail (st != NULL);
	g_return_if_fail (decl_space != NULL);
	if ((_tmp1_ = vala_ccode_declaration_space_add_symbol_declaration (decl_space, (ValaSymbol*) st, _tmp0_ = vala_typesymbol_get_cname ((ValaTypeSymbol*) st, FALSE)), _g_free0 (_tmp0_), _tmp1_)) {
		return;
	}
	if (vala_struct_get_base_struct (st) != NULL) {
		char* _tmp2_;
		char* _tmp3_;
		ValaCCodeVariableDeclarator* _tmp4_;
		ValaCCodeTypeDefinition* _tmp5_;
		vala_dova_base_module_generate_struct_declaration ((ValaDovaBaseModule*) self, vala_struct_get_base_struct (st), decl_space);
		vala_ccode_declaration_space_add_type_declaration (decl_space, (ValaCCodeNode*) (_tmp5_ = vala_ccode_type_definition_new (_tmp2_ = vala_typesymbol_get_cname ((ValaTypeSymbol*) vala_struct_get_base_struct (st), FALSE), (ValaCCodeDeclarator*) (_tmp4_ = vala_ccode_variable_declarator_new (_tmp3_ = vala_typesymbol_get_cname ((ValaTypeSymbol*) st, FALSE), NULL, NULL)))));
		_vala_ccode_node_unref0 (_tmp5_);
		_vala_ccode_node_unref0 (_tmp4_);
		_g_free0 (_tmp3_);
		_g_free0 (_tmp2_);
		return;
	}
	if (vala_struct_is_boolean_type (st)) {
		return;
	} else {
		if (vala_struct_is_integer_type (st)) {
			return;
		} else {
			if (vala_struct_is_decimal_floating_type (st)) {
				return;
			} else {
				if (vala_struct_is_floating_type (st)) {
					return;
				}
			}
		}
	}
	instance_struct = (_tmp8_ = vala_ccode_struct_new (_tmp7_ = g_strdup_printf ("_%s", _tmp6_ = vala_typesymbol_get_cname ((ValaTypeSymbol*) st, FALSE))), _g_free0 (_tmp7_), _g_free0 (_tmp6_), _tmp8_);
	{
		ValaList* _tmp9_;
		ValaIterator* _tmp10_;
		ValaIterator* _f_it;
		_f_it = (_tmp10_ = vala_iterable_iterator ((ValaIterable*) (_tmp9_ = vala_struct_get_fields (st))), _vala_collection_object_unref0 (_tmp9_), _tmp10_);
		while (TRUE) {
			ValaField* f;
			char* field_ctype;
			if (!vala_iterator_next (_f_it)) {
				break;
			}
			f = (ValaField*) vala_iterator_get (_f_it);
			field_ctype = vala_data_type_get_cname (vala_variable_get_variable_type ((ValaVariable*) f));
			if (vala_field_get_is_volatile (f)) {
				char* _tmp11_;
				field_ctype = (_tmp11_ = g_strconcat ("volatile ", field_ctype, NULL), _g_free0 (field_ctype), _tmp11_);
			}
			if (vala_field_get_binding (f) == MEMBER_BINDING_INSTANCE) {
				char* _tmp12_;
				char* _tmp13_;
				char* _tmp14_;
				vala_dova_base_module_generate_type_declaration ((ValaDovaBaseModule*) self, vala_variable_get_variable_type ((ValaVariable*) f), decl_space);
				vala_ccode_struct_add_field (instance_struct, field_ctype, _tmp14_ = g_strconcat (_tmp12_ = vala_field_get_cname (f), _tmp13_ = vala_data_type_get_cdeclarator_suffix (vala_variable_get_variable_type ((ValaVariable*) f)), NULL), NULL);
				_g_free0 (_tmp14_);
				_g_free0 (_tmp13_);
				_g_free0 (_tmp12_);
			}
			_g_free0 (field_ctype);
			_vala_code_node_unref0 (f);
		}
		_vala_collection_object_unref0 (_f_it);
	}
	vala_ccode_declaration_space_add_type_declaration (decl_space, (ValaCCodeNode*) (_tmp19_ = vala_ccode_type_definition_new (_tmp16_ = g_strdup_printf ("struct _%s", _tmp15_ = vala_typesymbol_get_cname ((ValaTypeSymbol*) st, FALSE)), (ValaCCodeDeclarator*) (_tmp18_ = vala_ccode_variable_declarator_new (_tmp17_ = vala_typesymbol_get_cname ((ValaTypeSymbol*) st, FALSE), NULL, NULL)))));
	_vala_ccode_node_unref0 (_tmp19_);
	_vala_ccode_node_unref0 (_tmp18_);
	_g_free0 (_tmp17_);
	_g_free0 (_tmp16_);
	_g_free0 (_tmp15_);
	vala_ccode_declaration_space_add_type_definition (decl_space, (ValaCCodeNode*) instance_struct);
	_vala_ccode_node_unref0 (instance_struct);
}


static gpointer _vala_ccode_node_ref0 (gpointer self) {
	return self ? vala_ccode_node_ref (self) : NULL;
}


static void vala_dova_struct_module_real_visit_struct (ValaCodeVisitor* base, ValaStruct* st) {
	ValaDovaStructModule * self;
	ValaDovaBaseModuleEmitContext* _tmp0_;
	ValaCCodeFragment* old_instance_finalize_fragment;
	ValaCCodeFragment* _tmp1_;
	ValaCCodeFragment* _tmp2_;
	self = (ValaDovaStructModule*) base;
	g_return_if_fail (st != NULL);
	vala_dova_base_module_push_context ((ValaDovaBaseModule*) self, _tmp0_ = vala_dova_base_module_emit_context_new ((ValaSymbol*) st));
	_vala_dova_base_module_emit_context_unref0 (_tmp0_);
	old_instance_finalize_fragment = _vala_ccode_node_ref0 (((ValaDovaBaseModule*) self)->instance_finalize_fragment);
	((ValaDovaBaseModule*) self)->instance_finalize_fragment = (_tmp1_ = vala_ccode_fragment_new (), _vala_ccode_node_unref0 (((ValaDovaBaseModule*) self)->instance_finalize_fragment), _tmp1_);
	vala_dova_base_module_generate_struct_declaration ((ValaDovaBaseModule*) self, st, ((ValaDovaBaseModule*) self)->source_declarations);
	if (!vala_symbol_is_internal_symbol ((ValaSymbol*) st)) {
		vala_dova_base_module_generate_struct_declaration ((ValaDovaBaseModule*) self, st, ((ValaDovaBaseModule*) self)->header_declarations);
	}
	vala_code_node_accept_children ((ValaCodeNode*) st, (ValaCodeVisitor*) self);
	((ValaDovaBaseModule*) self)->instance_finalize_fragment = (_tmp2_ = _vala_ccode_node_ref0 (old_instance_finalize_fragment), _vala_ccode_node_unref0 (((ValaDovaBaseModule*) self)->instance_finalize_fragment), _tmp2_);
	vala_dova_base_module_pop_context ((ValaDovaBaseModule*) self);
	_vala_ccode_node_unref0 (old_instance_finalize_fragment);
}


ValaDovaStructModule* vala_dova_struct_module_construct (GType object_type) {
	ValaDovaStructModule* self = NULL;
	self = (ValaDovaStructModule*) vala_dova_base_module_construct (object_type);
	return self;
}


ValaDovaStructModule* vala_dova_struct_module_new (void) {
	return vala_dova_struct_module_construct (VALA_TYPE_DOVA_STRUCT_MODULE);
}


static void vala_dova_struct_module_class_init (ValaDovaStructModuleClass * klass) {
	vala_dova_struct_module_parent_class = g_type_class_peek_parent (klass);
	VALA_DOVA_BASE_MODULE_CLASS (klass)->generate_struct_declaration = vala_dova_struct_module_real_generate_struct_declaration;
	VALA_CODE_VISITOR_CLASS (klass)->visit_struct = vala_dova_struct_module_real_visit_struct;
}


static void vala_dova_struct_module_instance_init (ValaDovaStructModule * self) {
}


GType vala_dova_struct_module_get_type (void) {
	static volatile gsize vala_dova_struct_module_type_id__volatile = 0;
	if (g_once_init_enter (&vala_dova_struct_module_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (ValaDovaStructModuleClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) vala_dova_struct_module_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (ValaDovaStructModule), 0, (GInstanceInitFunc) vala_dova_struct_module_instance_init, NULL };
		GType vala_dova_struct_module_type_id;
		vala_dova_struct_module_type_id = g_type_register_static (VALA_TYPE_DOVA_BASE_MODULE, "ValaDovaStructModule", &g_define_type_info, 0);
		g_once_init_leave (&vala_dova_struct_module_type_id__volatile, vala_dova_struct_module_type_id);
	}
	return vala_dova_struct_module_type_id__volatile;
}




