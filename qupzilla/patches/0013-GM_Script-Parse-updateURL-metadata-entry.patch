From c2b550c955101a3ddf3770fbb9c8d264e3338ecf Mon Sep 17 00:00:00 2001
From: David Rosca <nowrep@gmail.com>
Date: Thu, 28 May 2015 08:44:16 +0200
Subject: [PATCH 13/36] GM_Script: Parse @updateURL metadata entry

---
 src/plugins/GreaseMonkey/gm_script.cpp | 13 +++++++++----
 src/plugins/GreaseMonkey/gm_script.h   |  3 +++
 2 files changed, 12 insertions(+), 4 deletions(-)

diff --git a/src/plugins/GreaseMonkey/gm_script.cpp b/src/plugins/GreaseMonkey/gm_script.cpp
index 94d05f3..7aacb06 100644
--- a/src/plugins/GreaseMonkey/gm_script.cpp
+++ b/src/plugins/GreaseMonkey/gm_script.cpp
@@ -76,6 +76,11 @@ QUrl GM_Script::downloadUrl() const
     return m_downloadUrl;
 }
 
+QUrl GM_Script::updateUrl() const
+{
+    return m_updateUrl;
+}
+
 GM_Script::StartAt GM_Script::startAt() const
 {
     return m_startAt;
@@ -171,6 +176,7 @@ void GM_Script::parseScript()
     m_include.clear();
     m_exclude.clear();
     m_downloadUrl.clear();
+    m_updateUrl.clear();
     m_startAt = DocumentEnd;
     m_enabled = true;
     m_valid = false;
@@ -208,10 +214,6 @@ void GM_Script::parseScript()
         const QString key = line.left(index).trimmed();
         const QString value = line.mid(index + 1).trimmed();
 
-        // Ignored values:
-        //  @resource
-        //  @unwrap
-
         if (key.isEmpty() || value.isEmpty()) {
             continue;
         }
@@ -251,6 +253,9 @@ void GM_Script::parseScript()
         else if (key == QLatin1String("@downloadURL") && m_downloadUrl.isEmpty()) {
             m_downloadUrl = QUrl(value);
         }
+        else if (key == QLatin1String("@updateURL") && m_updateUrl.isEmpty()) {
+            m_updateUrl = QUrl(value);
+        }
     }
 
     if (m_include.isEmpty()) {
diff --git a/src/plugins/GreaseMonkey/gm_script.h b/src/plugins/GreaseMonkey/gm_script.h
index f0ec786..ca34663 100644
--- a/src/plugins/GreaseMonkey/gm_script.h
+++ b/src/plugins/GreaseMonkey/gm_script.h
@@ -48,6 +48,8 @@ public:
     QString version() const;
 
     QUrl downloadUrl() const;
+    QUrl updateUrl() const;
+
     StartAt startAt() const;
 
     bool isEnabled() const;
@@ -82,6 +84,7 @@ private:
     QVector<GM_UrlMatcher> m_exclude;
 
     QUrl m_downloadUrl;
+    QUrl m_updateUrl;
     StartAt m_startAt;
 
     QString m_script;
-- 
2.5.1

